<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Simple Chat Test</title>
  <style>
    /* ... All your existing CSS remains here ... */
  </style>
</head>
<body>
  <h1>Simple Chat Test</h1>
  <div id="topicTracker" class="topic-tracker"></div>
  <div id="chat" class="chat"></div>

  <input id="messageInput" type="text" placeholder="Type here..." autofocus/>
  <button id="sendButton">Send</button>
  <button id="pdfButton" style="width: auto; padding: 8px; float: right;">Download PDF</button>

  <script>
    const config = {
      chatWebhookUrl: 'YOUR_CHAT_WEBHOOK_URL',
      pdfWebhookUrl: 'YOUR_NEW_PDF_WEBHOOK_URL' // Create this new webhook in n8n
    };
    // ... all existing JS variables and functions (INTRO_MESSAGE, elements, chatHistory, etc.)

    // --- NEW: Function to handle PDF Download ---
    async function handleDownloadPdf() {
      const pdfButton = document.getElementById('pdfButton');
      pdfButton.disabled = true;
      pdfButton.textContent = 'Generating...';

      try {
        const response = await fetch(config.pdfWebhookUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ history: chatHistory })
        });

        if (!response.ok) throw new Error(`PDF Generation Error: ${response.status}`);

        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = 'Discovery_Report.pdf';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        
      } catch (error) {
        console.error('PDF Fetch error:', error);
        alert('Could not generate PDF report.');
      }

      pdfButton.disabled = false;
      pdfButton.textContent = 'Download PDF';
    }

    // --- Existing handleSend, renderMessage, etc. functions go here ---

    // --- Add New Event Listener ---
    document.getElementById('pdfButton').addEventListener('click', handleDownloadPdf);
    // ... your other event listeners
  </script>
</body>
</html>
